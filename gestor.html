<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestor de Pedidos - Cabana Açaí</title>
<style>
/* Estilos omitidos para brevidade */
</style>
</head>
<body>
<header>
  <div class="header-content">
    <img src="https://i.ibb.co/bJy9VxR/logo-cabana-png.jpg" alt="Cabana Açaí Logo" class="logo">
    <h1>Gestor de Pedidos - Cabana Açaí</h1>
  </div>
</header>
<main>
  <div class="columns">
    <div class="column" id="preparingColumn">
      <h2>Em preparo</h2>
    </div>
    <div class="column" id="deliveryColumn">
      <h2>Saiu pra entrega</h2>
    </div>
    <div class="column" id="finishedColumn">
      <h2>Finalizado</h2>
    </div>
  </div>
</main>

<!-- Adicione o Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script>
  // Configuração do Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyB-pF2lRStLTN9Xw9aYQj962qdNFyUXI2E",
    authDomain: "cabana-8d55e.firebaseapp.com",
    databaseURL: "https://cabana-8d55e-default-rtdb.firebaseio.com",
    projectId: "cabana-8d55e",
    storageBucket: "cabana-8d55e.appspot.com",
    messagingSenderId: "706144237954",
    appId: "1:706144237954:web:345c10370972486afc779b",
    measurementId: "G-96Y337GYT8"
  };

  // Inicialize o Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  function addOrderToColumn(order, columnId) {
    const column = document.getElementById(columnId);
    const orderDiv = document.createElement('div');
    orderDiv.className = 'order';
    orderDiv.innerHTML = `
      <h3>Pedido #${order.id}</h3>
      <p><strong>Nome:</strong> ${order.name}</p>
      <p><strong>Endereço:</strong> ${order.address}</p>
      <p><strong>Telefone:</strong> ${order.phone}</p>
      <p><strong>Método de Pagamento:</strong> ${order.paymentMethod}</p>
      ${order.changeNeeded ? `<p><strong>Precisa de troco:</strong> ${order.changeNeeded}</p>` : ''}
      ${order.changeAmount ? `<p><strong>Quanto de troco:</strong> R$ ${parseFloat(order.changeAmount).toFixed(2)}</p>` : ''}
      <p><strong>Itens do Pedido:</strong></p>
      <ul>
        ${order.items.map(item => `
          <li>${item.name} - R$ ${item.totalPrice.toFixed(2)}</li>
          ${item.accompaniments.length > 0 ? `<p>Acompanhamentos: ${item.accompaniments.join(', ')}</p>` : ''}
          ${item.extras.length > 0 ? `<p>Extras: ${item.extras.join(', ')}</p>` : ''}
        `).join('')}
      </ul>
      <p><strong>Subtotal:</strong> R$ ${order.subtotal.toFixed(2)}</p>
      <p><strong>Taxa de Entrega:</strong> R$ ${order.deliveryFee.toFixed(2)}</p>
      <p><strong>Total:</strong> R$ ${order.total.toFixed(2)}</p>
      ${order.status === 'finished' 
        ? `<button class="btn" onclick="finishOrder('${order.id}')">Finalizar</button>` 
        : `<button class="btn" onclick="advanceOrder('${order.id}')">Avançar</button>`}
    `;
    column.appendChild(orderDiv);
  }

  function displayOrders(orders) {
    document.getElementById('preparingColumn').innerHTML = '<h2>Em preparo</h2>';
    document.getElementById('deliveryColumn').innerHTML = '<h2>Saiu pra entrega</h2>';
    document.getElementById('finishedColumn').innerHTML = '<h2>Finalizado</h2>';

    orders.forEach(order => {
      if (order.status === 'preparing') {
        addOrderToColumn(order, 'preparingColumn');
      } else if (order.status === 'delivery') {
        addOrderToColumn(order, 'deliveryColumn');
      } else if (order.status === 'finished') {
        addOrderToColumn(order, 'finishedColumn');
      }
    });
  }

  function advanceOrder(orderId) {
    const orderRef = db.collection('orders').doc(orderId);
    orderRef.get().then(doc => {
      if (doc.exists) {
        const order = doc.data();
        let newStatus = 'preparing';
        if (order.status === 'preparing') {
          newStatus = 'delivery';
        } else if (order.status === 'delivery') {
          newStatus = 'finished';
        }
        orderRef.update({ status: newStatus });
      }
    });
  }

  function finishOrder(orderId) {
    db.collection('orders').doc(orderId).delete();
  }

  // Listener para o evento de armazenamento
  db.collection('orders').onSnapshot(snapshot => {
    const orders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    displayOrders(orders);
  });
</script>
</body>
</html>
