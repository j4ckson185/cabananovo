<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestor de Pedidos - Cabana Açaí</title>
<style>
:root {
  --primary-color: #4a0e4e;
  --secondary-color: #8e44ad;
  --background-color: #f5f5f5;
  --text-color: #333;
}
body {
  font-family: 'Arial', sans-serif;
  margin: 0;
  padding: 0;
  background-color: var(--background-color);
  color: var(--text-color);
}
header {
  background-color: var(--primary-color);
  color: white;
  padding: 1em 0;
  text-align: center;
}
.header-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}
.logo {
  width: 150px;
  height: auto;
  margin-bottom: 10px;
}
main {
  max-width: 1200px;
  margin: 2em auto;
  padding: 0 20px;
}
.columns {
  display: flex;
  justify-content: space-between;
}
.column {
  width: 32%;
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  padding: 1em;
  box-sizing: border-box;
}
.column h2 {
  text-align: center;
  margin-bottom: 1em;
  color: var(--primary-color);
}
.order {
  background-color: var(--background-color);
  border-radius: 4px;
  padding: 1em;
  margin-bottom: 1em;
}
.order h3 {
  margin: 0 0 0.5em 0;
}
.order p {
  margin: 0.5em 0;
}
.btn {
  display: inline-block;
  padding: 0.5em 1em;
  background-color: var(--primary-color);
  color: white;
  text-decoration: none;
  border-radius: 4px;
  transition: background-color 0.3s ease;
  border: none;
  cursor: pointer;
}
.btn:hover {
  background-color: var(--secondary-color);
}
</style>
</head>
<body>
<header>
  <div class="header-content">
    <img src="https://i.ibb.co/bJy9VxR/logo-cabana-png.jpg" alt="Cabana Açaí Logo" class="logo">
    <h1>Gestor de Pedidos - Cabana Açaí</h1>
  </div>
</header>
<main>
  <div class="columns">
    <div class="column" id="preparingColumn">
      <h2>Em preparo</h2>
    </div>
    <div class="column" id="deliveryColumn">
      <h2>Saiu pra entrega</h2>
    </div>
    <div class="column" id="finishedColumn">
      <h2>Finalizado</h2>
    </div>
  </div>
</main>

<!-- Adicione o Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script>
  // Configuração do Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyB-pF2lRStLTN9Xw9aYQj962qdNFyUXI2E",
    authDomain: "cabana-8d55e.firebaseapp.com",
    databaseURL: "https://cabana-8d55e-default-rtdb.firebaseio.com",
    projectId: "cabana-8d55e",
    storageBucket: "cabana-8d55e.appspot.com",
    messagingSenderId: "706144237954",
    appId: "1:706144237954:web:345c10370972486afc779b",
    measurementId: "G-96Y337GYT8"
  };

  // Inicialize o Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

let orders = [];

function addOrderToColumn(order, columnId) {
  const column = document.getElementById(columnId);
  const orderDiv = document.createElement('div');
  orderDiv.className = 'order';
  orderDiv.innerHTML = `
    <h3>Pedido #${order.id}</h3>
    <p><strong>Nome:</strong> ${order.name}</p>
    <p><strong>Endereço:</strong> ${order.address}</p>
    <p><strong>Telefone:</strong> ${order.phone}</p>
    <p><strong>Método de Pagamento:</strong> ${order.paymentMethod}</p>
    ${order.changeNeeded ? `<p><strong>Precisa de troco:</strong> ${order.changeNeeded}</p>` : ''}
    ${order.changeAmount ? `<p><strong>Quanto de troco:</strong> R$ ${parseFloat(order.changeAmount).toFixed(2)}</p>` : ''}
    <p><strong>Itens do Pedido:</strong></p>
    <ul>
      ${order.items.map(item => `
        <li>${item.name} - R$ ${item.totalPrice.toFixed(2)}</li>
        ${item.accompaniments.length > 0 ? `<p>Acompanhamentos: ${item.accompaniments.join(', ')}</p>` : ''}
        ${item.extras.length > 0 ? `<p>Extras: ${item.extras.join(', ')}</p>` : ''}
      `).join('')}
    </ul>
    <p><strong>Subtotal:</strong> R$ ${order.subtotal.toFixed(2)}</p>
    <p><strong>Taxa de Entrega:</strong> R$ ${order.deliveryFee.toFixed(2)}</p>
    <p><strong>Total:</strong> R$ ${order.total.toFixed(2)}</p>
    ${order.status === 'finished' 
      ? `<button class="btn" onclick="finishOrder(${order.id})">Finalizar</button>` 
      : `<button class="btn" onclick="advanceOrder(${order.id})">Avançar</button>`}
  `;
  column.appendChild(orderDiv);
}

function displayOrders() {
  document.getElementById('preparingColumn').innerHTML = '<h2>Em preparo</h2>';
  document.getElementById('deliveryColumn').innerHTML = '<h2>Saiu pra entrega</h2>';
  document.getElementById('finishedColumn').innerHTML = '<h2>Finalizado</h2>';

  orders.forEach(order => {
    if (order.status === 'preparing') {
      addOrderToColumn(order, 'preparingColumn');
    } else if (order.status === 'delivery') {
      addOrderToColumn(order, 'deliveryColumn');
    } else if (order.status === 'finished') {
      addOrderToColumn(order, 'finishedColumn');
    }
  });
}

function advanceOrder(orderId) {
  const order = orders.find(o => o.id === orderId);
  if (order.status === 'preparing') {
    order.status = 'delivery';
  } else if (order.status === 'delivery') {
    order.status = 'finished';
  }
  db.collection('orders').doc(order.id).update({ status: order.status });
}

function finishOrder(orderId) {
  db.collection('orders').doc(orderId).delete();
}

// Listener para o Firestore
db.collection('orders').onSnapshot(snapshot => {
  orders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
  displayOrders();
});

</script>
  <script>
  function atualizarPedidos() {
    const pedidos = JSON.parse(localStorage.getItem('pedidos') || '[]');
    const emPreparo = document.querySelector('#em-preparo');
    const saiuParaEntrega = document.querySelector('#saiu-para-entrega');
    const finalizado = document.querySelector('#finalizado');

    emPreparo.innerHTML = '';
    saiuParaEntrega.innerHTML = '';
    finalizado.innerHTML = '';

    pedidos.forEach((pedido, index) => {
      const pedidoElement = document.createElement('div');
      pedidoElement.innerHTML = `
        <p>Nome: ${pedido.nome}</p>
        <p>Endereço: ${pedido.endereco}</p>
        <p>Telefone: ${pedido.telefone}</p>
        <p>Método de Pagamento: ${pedido.metodoPagamento}</p>
        <p>Precisa de Troco: ${pedido.precisaTroco}</p>
        <p>Troco: ${pedido.troco}</p>
        <button onclick="atualizarStatus(${index}, 'Em preparo')">Em preparo</button>
        <button onclick="atualizarStatus(${index}, 'Saiu pra entrega')">Saiu pra entrega</button>
        <button onclick="atualizarStatus(${index}, 'Finalizado')">Finalizado</button>
      `;

      switch(pedido.status) {
        case 'Em preparo':
          emPreparo.appendChild(pedidoElement);
          break;
        case 'Saiu pra entrega':
          saiuParaEntrega.appendChild(pedidoElement);
          break;
        case 'Finalizado':
          finalizado.appendChild(pedidoElement);
          break;
      }
    });
  }

  function atualizarStatus(index, novoStatus) {
    const pedidos = JSON.parse(localStorage.getItem('pedidos') || '[]');
    pedidos[index].status = novoStatus;
    localStorage.setItem('pedidos', JSON.stringify(pedidos));
    atualizarPedidos();
  }

  // Atualizar pedidos a cada 5 segundos
  setInterval(atualizarPedidos, 5000);

  // Atualizar pedidos imediatamente ao carregar a página
  atualizarPedidos();
</script>
</body>
</html>
