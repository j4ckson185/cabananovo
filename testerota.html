<!DOCTYPE html>
<html>
<head>
    <title>Teste Rotas Motoboys</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial; margin: 20px; }
        .container { max-width: 800px; margin: auto; padding: 20px; border: 1px solid #ddd; }
        input, select, textarea { width: 100%; margin: 5px 0; padding: 5px; }
        button { background: #25D366; color: white; padding: 10px; border: none; cursor: pointer; }
        .error { color: red; margin: 10px 0; }
        .success { color: green; margin: 10px 0; }
        #debug { background: #f5f5f5; padding: 10px; margin-top: 20px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Teste de Rotas - Motoboys</h2>
        
        <div>
            <label>URL da Função:</label>
            <input type="text" id="functionUrl" placeholder="URL da sua função Twilio">
        </div>

        <div>
            <label>Destinatário:</label>
            <select id="motoboy">
                <option value="Eduardo">Eduardo (84987673202)</option>
                <option value="Gabriel Andrade">Gabriel Andrade (84988529385)</option>
                <option value="Boaz">Boaz (8492090818)</option>
                <option value="Rafael">Rafael (8491472409)</option>
            </select>
        </div>

        <div>
            <label>Endereços (um por linha):</label>
            <textarea id="enderecos" rows="6" placeholder="Exemplo:
Rua Monte Sinai, 123, Potengi
Av. das Fronteiras, 456, N. Sra. Apresentação
Rua João Medeiros, 789, Pajuçara"></textarea>
        </div>

        <button onclick="testar()">Testar Envio</button>

        <div id="error" class="error" style="display:none"></div>
        <div id="success" class="success" style="display:none"></div>
        <div id="debug"></div>
    </div>

    <script>
        const numerosPorNome = {
            'Eduardo': '+5584987673202',
            'Gabriel Andrade': '+5584988529385',
            'Boaz': '+558492090818',
            'Rafael': '+558491472409'
        };

        function log(msg) {
            const debug = document.getElementById('debug');
            debug.innerHTML += msg + '<br>';
            console.log(msg);
        }

        function showError(msg) {
            document.getElementById('error').style.display = 'block';
            document.getElementById('error').innerText = msg;
            document.getElementById('success').style.display = 'none';
        }

        function showSuccess(msg) {
            document.getElementById('success').style.display = 'block';
            document.getElementById('success').innerText = msg;
            document.getElementById('error').style.display = 'none';
        }

        async function testar() {
            const debug = document.getElementById('debug');
            debug.innerHTML = '';
            
            try {
                const url = document.getElementById('functionUrl').value;
                const motoboy = document.getElementById('motoboy').value;
                const enderecos = document.getElementById('enderecos').value
                    .split('\n')
                    .filter(e => e.trim());

                if (!url) {
                    throw new Error('Informe a URL da função');
                }

                if (enderecos.length < 6) {
                    throw new Error('Adicione pelo menos 6 endereços');
                }

                log('Iniciando teste...');
                log(`Destinatário: ${motoboy}`);
                log(`Número: whatsapp:${numerosPorNome[motoboy]}`);
                log(`Total de endereços: ${enderecos.length}`);

                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        test: 'true',
                        motoboy: motoboy,
                        numero: `whatsapp:${numerosPorNome[motoboy]}`,
                        enderecos: enderecos
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    showSuccess('Teste enviado com sucesso!');
                    log('Resposta: ' + JSON.stringify(data, null, 2));
                } else {
                    throw new Error(data.error || 'Erro no envio');
                }

            } catch (error) {
                showError(error.message);
                log('Erro: ' + error.message);
            }
        }
    </script>
</body>
</html>
