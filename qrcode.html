<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste PIX</title>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        #payment-form {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        .qr-container {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Teste PIX</h1>
    <div id="payment-form">
        <div id="qr-container"></div>
        <button onclick="gerarPix()">Gerar PIX R$ 25,00</button>
    </div>

    <script>
        // Inicializar o Mercado Pago
        const mp = new MercadoPago('APP_USR-813bb304-1460-4892-bc0f-9b2522655bc3');

        async function gerarPix() {
            const qrContainer = document.getElementById('qr-container');
            qrContainer.innerHTML = 'Gerando PIX...';

            try {
                // Primeiro criar uma preferência
                const preference = await mp.createPayment({
                    transaction_amount: 25,
                    description: "Teste PIX",
                    payment_method_id: "pix",
                    payer: {
                        email: "cliente@teste.com"
                    }
                });

                console.log('Preferência criada:', preference);

                // Gerar o QR Code
                qrContainer.innerHTML = `
                    <div class="qr-container">
                        <h3>Escaneie o QR Code</h3>
                        <img src="${preference.point_of_interaction.transaction_data.qr_code_base64}" 
                             alt="QR Code PIX"
                             style="width: 200px; height: 200px;">
                        <div style="margin-top: 20px;">
                            <p><strong>Ou copie o código PIX:</strong></p>
                            <input type="text" 
                                   value="${preference.point_of_interaction.transaction_data.qr_code}" 
                                   readonly 
                                   style="width: 100%; padding: 10px;">
                            <button onclick="copiarCodigo(this)">Copiar</button>
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('Erro:', error);
                qrContainer.innerHTML = `
                    <div style="color: red; padding: 20px;">
                        Erro ao gerar PIX. Tente novamente.
                    </div>
                `;
            }
        }

        function copiarCodigo(button) {
            const input = button.previousElementSibling;
            input.select();
            document.execCommand('copy');
            button.textContent = 'Copiado!';
            setTimeout(() => button.textContent = 'Copiar', 2000);
        }
    </script>
</body>
</html>
