<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste PIX QR Code</title>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        #pixInfo {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        .loading {
            text-align: center;
            padding: 20px;
        }
        .error {
            color: red;
            padding: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Teste de PIX QR Code</h1>
    <button onclick="gerarPix()">Gerar PIX R$ 25,00</button>
    <div id="pixInfo"></div>

    <script>
        async function gerarPix() {
            const pixInfo = document.getElementById('pixInfo');
            pixInfo.innerHTML = '<div class="loading">Gerando QR Code PIX...</div>';

            try {
                const response = await fetch('https://api.mercadopago.com/v1/payments', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer APP_USR-5690418429869747-031817-f6ee6e1b8317cfd7526ff7bd547728e7-257593839',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        transaction_amount: 25.00,
                        description: "Teste PIX",
                        payment_method_id: "pix",
                        payer: {
                            email: "cliente@email.com",
                            first_name: "Cliente Teste",
                            identification: {
                                type: "CPF",
                                number: "06561938402"
                            }
                        }
                    })
                });

                const data = await response.json();
                console.log('Resposta MP:', data);

                if (data.point_of_interaction?.transaction_data?.qr_code_base64) {
                    const qrData = data.point_of_interaction.transaction_data;
                    
                    pixInfo.innerHTML = `
                        <div style="text-align: center">
                            <h2>PIX Gerado</h2>
                            
                            <div style="background: white; padding: 20px; display: inline-block; margin: 20px 0; border: 1px solid #ccc;">
                                <img src="data:image/png;base64,${qrData.qr_code_base64}" 
                                     style="width: 250px; height: 250px;">
                            </div>
                            
                            <div style="margin: 20px 0">
                                <p><strong>Código PIX para copiar:</strong></p>
                                <div style="position: relative; margin: 10px 0">
                                    <input type="text" 
                                           value="${qrData.qr_code}" 
                                           readonly 
                                           style="width: 90%; padding: 10px">
                                    <button onclick="copiarCodigo(this)">Copiar</button>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    throw new Error('QR Code não encontrado na resposta');
                }

            } catch (error) {
                console.error('Erro:', error);
                pixInfo.innerHTML = `
                    <div class="error">
                        Erro ao gerar PIX. Por favor, tente novamente.<br>
                        Detalhes: ${error.message}
                    </div>
                `;
            }
        }

        function copiarCodigo(button) {
            const input = button.previousElementSibling;
            input.select();
            document.execCommand('copy');
            button.textContent = 'Copiado!';
            setTimeout(() => {
                button.textContent = 'Copiar';
            }, 2000);
        }
    </script>
</body>
</html>
