<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste PIX</title>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        #payment-form {
            margin-top: 20px;
        }
        #payment-brick {
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>Teste PIX</h1>
    <div id="payment-form">
        <div id="payment-brick"></div>
    </div>

    <script>
        const mp = new MercadoPago('APP_USR-813bb304-1460-4892-bc0f-9b2522655bc3');

        async function createPreference() {
            try {
                const response = await fetch('https://api.mercadopago.com/checkout/preferences', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer APP_USR-5690418429869747-031817-f6ee6e1b8317cfd7526ff7bd547728e7-257593839',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        items: [{
                            title: 'Teste PIX',
                            quantity: 1,
                            currency_id: 'BRL',
                            unit_price: 25.00
                        }],
                        payment_methods: {
                            default_payment_method_id: 'pix',
                            excluded_payment_types: [
                                { id: "credit_card" },
                                { id: "debit_card" }
                            ]
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error('Erro ao criar preferência');
                }

                const preference = await response.json();
                console.log('Preferência criada:', preference);
                return preference.id;
            } catch (error) {
                console.error('Erro ao criar preferência:', error);
                throw error;
            }
        }

        async function initPaymentBrick(preferenceId) {
            const settings = {
                initialization: {
                    amount: 25.00, // Adicionado o amount
                    preferenceId: preferenceId
                },
                callbacks: {
                    onReady: () => {
                        console.log('Brick pronto');
                    },
                    onSubmit: async (data) => {
                        console.log('Pagamento submetido:', data);
                    },
                    onError: (error) => {
                        console.error('Erro no brick:', error);
                    }
                },
                locale: 'pt-BR',
                customization: {
                    paymentMethods: {
                        maxInstallments: 1
                    }
                }
            };

            try {
                const brickBuilder = mp.bricks();
                const brick = await brickBuilder.create('payment', 'payment-brick', settings);
                console.log('Brick criado com sucesso');
            } catch (error) {
                console.error('Erro ao criar brick:', error);
                document.getElementById('payment-brick').innerHTML = `
                    <div style="color: red; padding: 20px; text-align: center;">
                        <p>Erro ao inicializar pagamento</p>
                        <small style="display: block; margin-top: 10px;">${error.message}</small>
                    </div>
                `;
            }
        }

        // Iniciar quando a página carregar
        window.addEventListener('load', async () => {
            document.getElementById('payment-brick').innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <p>Inicializando pagamento...</p>
                </div>
            `;

            try {
                const preferenceId = await createPreference();
                await initPaymentBrick(preferenceId);
            } catch (error) {
                console.error('Erro na inicialização:', error);
                document.getElementById('payment-brick').innerHTML = `
                    <div style="color: red; padding: 20px; text-align: center;">
                        <p>Erro ao iniciar pagamento</p>
                        <small style="display: block; margin-top: 10px;">${error.message}</small>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
